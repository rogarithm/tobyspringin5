https://github.com/tobyilee/tobyspringin5

## 새로운 데이터베이스 만들기
루트 계정으로 들어가야 데이터베이스를 만들 수 있다. 루트 계정 비밀번호 확인은 이렇게 했다.
- docker inspect mysql_db_1 | grep PASS (https://stackoverflow.com/a/69368899)

그 다음 create database testdb; 로 testdb 데이터베이스를 만들었다.

이후 testdb에 users 테이블을 만들었다.

특정 사용자에 접근 권한 주기
데이터베이스를 만들었는데 테스트가 실패했다. spring 사용자에 testdb의 users 테이블 접근 권한이 없어 그렇다.
USE mysql;
CREATE USER 'spring'@'localhost' IDENTIFIED BY 'book'; // 이미 사용자가 만들어져 있어서 하지 않았던 것 같다
GRANT ALL ON *.* TO 'spring'@'localhost';
FLUSH PRIVILEGES;

이후에도 Access denied for user 'spring'@'%' to database 오류가 났다.
mysql에서 select host, user from user;로 유저 및 권한을 확인해보니 localhost에서 접속할 수 있는 spring 사용자와 %에서
접속할 수 있는 spring 사용자 둘이 있었다. 나는 localhost spring 사용자에만 권한을 줬는데 인텔리제이에서는 % spring 사용자로
testdb에 접속할 수 있어야 하나보다. 그래서 다음 두 명령으로 % spring 사용자에도 권한을 부여했고, 잘 되는 것을 확인했다.

GRANT ALL ON *.* TO 'spring'@'%';
FLUSH PRIVILEGES;



## terminal에서 mysql 실행 명령 알아내고 스크립트로 만들기

 실행할 명령
 - docker exec -it mysql_db_1 bash
 - mysql -u spring -p
 - use springbook;
 - delete from users;

 실험 기록
 - 여기 참고했다. https://subicura.com/2017/01/19/docker-guide-for-beginners-2.html
 - 콘테이너를 만들고 mysql을 실행해야 하는 것 같다.
 - docker run --rm -it mysql:8.0.30 bash -> mysql -u spring -p 했을 때 실패. 이후 콘테이너는 자동으로 지워졌다.
 - 이미지 이름으로 실행하면 (docker run mysql:8.0.30) 실패했다.

## Spring 5에서 달라진 부분 중 모르는 것

 - @ExtendWith(SpringExtension.class)에서 SpringExtension은 뭐하는 클래스인가?
 - @ContextConfiguration(locations = {"classpath:applicationContext.xml"}) 설정값을 토비님과 같이 했는데도
 INFO: Loaded default TestExecutionListener class names from location [META-INF/spring.factories]
 오류 메시지가 나온다. 어떻게 해결해야 하나?

## sql 연동
 - 내가 설치한 mysql db에 맞춰야 하나 해서 맞추려고 했는데 안됐다.
 - docker/mysql/docker-compose.yml에 이 프로젝트에서 쓰는 db가 정의되어 있었다.
 - docker로 sql 설정하려고 docker 및 docker-compose를 깔았다. 이 과정에서 여러 가지 실패 겪음(homebrew, 최신 버전 docker 호환 불가)
 - 깐 다음에도 userDao 테스트 실패해서 어떤 sql 쓰는지 설정해보려고 한다.
 - 알고보니 preparedStatement의 parameter number를 모두 1로 설정해놔서 2, 3번째에 값이 없어서 오류가 발생한 거였다...

### 참고한 사이트
- https://deockstory.tistory.com/25
  토비의 스프링 환경 그대로 하려고 한 분. docker 설정 등 참고할 점이 있었다.
- https://github.com/Deocksoo/Toby-spring-exmaple/commit/e34c5f8efa9569228f74441ee96b6956c689eef9
  바로 윗 분이 만드신 깃헙 저장소.

### docker 실행 어떻게 하는가?
 - docker/mysql 디렉토리로 이동해서 docker-compose.yml 설정에 따라 mysql을 설치
    $ cd docker
    $ docker-compose up -d
 - docker ps 하면 실행 중인 컨테이너를 모두 보여준다. mysql은 mysql_db_1이라는 이름으로 실행되고 있다.
 - database에 각 모듈별로 필요한 table을 만들어야 한다. intellij ultimate 버전이라면 intellij 안에서도 할 수 있지만,
 community 버전이라면 지원하지 않는다. 로컬에서 mysql 콘솔을 띄워 만들어주면 된다.

 - docker 실행은 docker 앱에서 알려준다. docker run -d -p 80:80 docker/getting-started

### docker에서 실행한 mysql 콘솔 어떻게 조작하나?
 - $ docker exec -it mysql_db_1 bash로 bash를 연다.
 - bash-4.4# mysql -u spring -p 명령을 실행하고 (여기선 $ 대신 bash-4.4#다) 패스워드(book)을 입력하면 mysql을 실행할 수 있다.
 - 데이터베이스를 확인하고 알맞은 것을 고른다.
 mysql> show databases;
 +--------------------+
 | Database           |
 +--------------------+
 | information_schema |
 | performance_schema |
 | springbook         |
 +--------------------+
 3 rows in set (0.01 sec)
 - springbook 데이터베이스를 고른다.
 mysql> use springbook;
 Database changed
 - 다음엔 sql/ 디렉토리 안 sql 명령을 참고해서 users 테이블을 만들어준다. 테이블을 만들어야 DAO 테스트 예제를 실행할 수 있다.

## java version 맞추기

 - 꽤나 여러가지 설정을 맞춰줘야 한다.
 - external libraries에 나오는 java version을 맞추려면 File - Project Structure 메뉴에서 설정해야 한다.
 - 위 내용을 찾으려고 intellij change external libraries으로 검색했다.